# 一、安装依赖以及运行

1. 安装依赖：cd 到根目录之后，使用 `yarn` 命令来安装所有依赖。

```shell
MacBook-Pro:test-backend frank$ yarn 
yarn install v1.17.3
[1/4] 🔍  Resolving packages...
success Already up-to-date.
✨  Done in 0.27s.
MacBook-Pro:test-backend frank$ 
```

2. 运行：您可以看到 `package.json` 中的 `script`，正如您所见，执行命令：

```
MacBook-Pro:test-backend frank$ yarn run start
yarn run v1.17.3
$ rm -rf /dist && tsc && node ./dist/app.js
(node:30079) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect.
(node:30079) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.
Mongoose connected to mongodb://localhost:27017/test
```



# 二、编写流程

## 1. 配置文件

在编写之前，您可以在 `./config` 文件夹中添加您所需要的任何配置文件。

## 2.Schema与model

1. 如果您需要设计 `Schema`，您需要先在 `./model/types`中定义它的字段，我们确保使用该类。
2. 在 `./model/entity`中添加您的 `schema`文件。您还可以查看已经编写好的实例，或许对您有所帮助。

## 3. 确认API的参数、返回值、参数类型、返回值类型

当您设计好编写API思路时，您务必先确认该API的参数、参数类型、返回值、返回值类型，并且在 `./types`文件夹中添加对应的 `interface ` ，您也可以查看已编写好的实例，或许对您有所帮助。

## 4. Service

您可以在 `./service` 文件夹中编写有关的方法

## 5. Controller

1. 您需要在 `./controller` 中编写 `router`，查看实例或许也会对您有所帮助。

2. 编写完成之后，您必须在 `./app.ts` 文件中引入路由，例如
 ```js
   // api.ts
   
   import usersRouter from './routers/users.controller'
   // ...
   const app = express() // #
   // ...
   app.use('/api/users', usersRouter)  // 该行代码必须在 上述 # 代码之后
 ```
3. **★值得注意的是该项目的 `token`传递方式**，您可以滑到第七条 `postman`来查看对应的策略

##6. 或许您可能需要编写测试用例

没关系，让我们在 `./test` 文件中编写它们！当您编写完测试用例之后，您可以使用以下代码进行测试：

```js
MacBook-Pro:test-backend frank$ yarn run test
yarn run v1.17.3
$ mocha "./{,!(node_modules)/**/}*.test.ts"
  service.user:
Mongoose connected to mongodb://localhost:27017/test
    ✓ should create user (54ms)


  1 passing (62ms)
```

正如您所见，您的代码通过了测试用例。



## 7. PostMan测试

> Note：请注意，已存在的大部分接口需要传递Token。
>
> **token**前面要加前缀： Bearer xxxxxx （注意Bearer和token之间有）

![nT4yHe.png](https://s2.ax1x.com/2019/09/18/nT4yHe.png)

